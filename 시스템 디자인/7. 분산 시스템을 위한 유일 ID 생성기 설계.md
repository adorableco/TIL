
## 다중 마스터 복제 (multi-master replication)

![Image](https://github.com/user-attachments/assets/35de502d-0b00-4b1d-837a-eaaae004896f)
- 데이터베이스의 `auto_increment` 기능을 활용함
	- 각 데이터베이스에서 다음 ID의 값을 구할 때 **서버 개수 k 만큼 증가하도록**

#### 단점

- 여러 데이터 센터에 걸쳐 규모를 늘리기 어려움
- ID의 유일성은 보장되겠지만 그 값이 **시간 흐름에 맞추어 커지도록 보장할 수 없음**
- 서버를 추가하거나 삭제할 때도 잘 동작하도록 만들기 어려움 (확장성 구림)


***
## UUID

![Image](https://github.com/user-attachments/assets/8387e659-969c-441e-9174-37140c98b8b9)

- 128비트짜리 수
- 충돌 가능성이 지극히 낮음
- 서버 사이에 조율이 필요 없으므로 동기화 이슈도 없음
- 각 서버가 자기가 쓸 ID를 알아서 만드는 구조이므로 규모 확장도 쉬움
#### 단점

- ID가 128비트로 김
- 시간순으로 정렬 불가
- ID에 숫자가 아닌 값이 포함될 수 있음


***
## 티켓 서버

![Image](https://github.com/user-attachments/assets/26e3958c-88ba-4334-8e62-a7332f5854a3)

- `auto_increment` 기능을 갖춘 데이터 서버, 즉 티켓 서버를 중앙 집중형으로 하나만 사용하는 것

#### 장점

- 유일성이 보장되는 오직 숫자로만 구성된 ID를 쉽게 만들 수 있음
- 구현하기 쉽고, 중소 규모 애플리케이션에 적합함

#### 단점

- 티켓 서버가 **SPOF(Single Point of Failure)** 가 됨


***
## 트위터 스노플레이크 접근법

![Image](https://github.com/user-attachments/assets/b4947bf1-5b31-4748-a4fd-160c957bc4ef)

- `사인(sign) 비트`: 음수와 양수를 구분하는 데 사용 가능
- `타임스탬프`: 기원 시각 (epoch) 이후로부터 몇 밀리초가 경과했는지 나타내는 값
- `데이터 센터 ID`: 32개의 데이터 센터 지정 가능
- `서버 ID`: 데이터 센터 당 32개 서버 지정 가능
- `일련번호`: 각 서버에서 ID를 생성할 때마다 일련 번호를 1만큼 증가시킴
	- 이 값은 1밀리초가 경과할 때마다 0으로 리셋


- 타임스탬프를 41비트로 표현하면 69년 동안 정상 동작함
	- 69년이 지나면 기원 시각을 바꾸거나 ID 체계를 이전해야 함
- 어떤 UTC 시각도 타임스탬프 값으로 변환할 수 있음


***
## 추가사항

### 시계 동기화 (clock synchronization)

- 하나의 서버가 여러 코어에서 실행되거나, 여러 서버가 물리적으로 독립된 여러 장비에서 실행되는 경우에는 같은 시계를 사용하지 않을 수도 있음
	- 시계 동기화를 고려해야 함
	- 주로 [**NTP (Network Time Protocol)**](https://ko.wikipedia.org/wiki/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC_%ED%83%80%EC%9E%84_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C) 로 문제를 해결함